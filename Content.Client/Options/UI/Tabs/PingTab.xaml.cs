using Robust.Client.AutoGenerated;
using Robust.Client.UserInterface;
using Robust.Client.UserInterface.Controls;
using Robust.Client.UserInterface.XAML;
using Content.Shared.DeadSpace.GhostRoleNotify.Prototypes;
using Robust.Shared.Prototypes;
using Robust.Shared.Configuration;
using Content.Shared.DeadSpace.CCCCVars;
using Content.Client.DeadSpace.NotifySystem.NotifyFunctions;

namespace Content.Client.Options.UI.Tabs;

[GenerateTypedNameReferences]

public sealed partial class PingTab : Control
{
    private void AddCheckBox(string checkBoxName, string id, IConfigurationManager cfg, bool savedSelection)
    {
        CheckBox newCheckBox = new CheckBox() { Text = Loc.GetString(checkBoxName) };
        newCheckBox.Pressed = savedSelection;
        newCheckBox.OnToggled += (lol) =>
        {
            NotifyFunction._dictAccess[id] = newCheckBox.Pressed;
            cfg.SetCVar(CCCCVars.SysNotifyCvar, NotifyFunction.PairListToString(NotifyFunction._dictAccess));
            cfg.SaveToFile();
        };

        PingsCont.AddChild(newCheckBox);
    }
    public PingTab()
    {
        var prototypeManager = IoCManager.Resolve<IPrototypeManager>();
        var cfg = IoCManager.Resolve<IConfigurationManager>();
        RobustXamlLoader.Load(this);
        foreach (var proto in prototypeManager.EnumeratePrototypes<GhostRoleGroupNotify>())
        {
            AddCheckBox(proto.Name, proto.ID, cfg, NotifyFunction._dictAccess[proto.ID]);
        }
        Control.Initialize();
    }
}
