using Robust.Client.AutoGenerated;
using Robust.Client.UserInterface;
using Robust.Client.UserInterface.Controls;
using Robust.Client.UserInterface.XAML;
using Content.Shared.DeadSpace.GhostRoleNotify.Prototypes;
using Robust.Shared.Prototypes;
using Robust.Shared.Configuration;
using Content.Shared.DeadSpace.CCCCVars;
using Content.Client.DeadSpace.NotifySystem.NotifyHelpers;
using Content.Client.DeadSpace.NotifySystem.RecievNotify;

namespace Content.Client.Options.UI.Tabs;

[GenerateTypedNameReferences]

public sealed partial class PingTab : Control
{
    private void AddCheckBox(string checkBoxName, string id, IConfigurationManager cfg, NotifyHelper helper, bool savedSelection)
    {
        CheckBox newCheckBox = new CheckBox() { Text = Loc.GetString(checkBoxName) };
        newCheckBox.Pressed = savedSelection;
        newCheckBox.OnToggled += lol =>
        {
            helper.SetValueAccess(id, newCheckBox.Pressed);
            cfg.SetCVar(CCCCVars.SysNotifyCvar, helper.PairListToString(helper.GetDictionaryAccess()));
            cfg.SaveToFile();
        };

        PingsCont.AddChild(newCheckBox);
    }
    public PingTab()
    {
        var prototypeManager = IoCManager.Resolve<IPrototypeManager>();
        var cfg = IoCManager.Resolve<IConfigurationManager>();
        var helper = RecievNotifySys._helper;
        RobustXamlLoader.Load(this);
        foreach (var proto in prototypeManager.EnumeratePrototypes<GhostRoleGroupNotify>())
        {
            AddCheckBox(proto.Name, proto.ID, cfg, helper, helper.GetValueAccess(proto.ID));
        }
        Control.Initialize();
    }
}
